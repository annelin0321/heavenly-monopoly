<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¤©åœ‹å¤§å¯Œç¿ï¼šæ‡‰è¨±ä¹‹åœ°</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'adventure-bg': '#E6D5B8', 
              'adventure-paper': '#F3E5AB',
              'adventure-ink': '#3E2723',
              'adventure-gold': '#B8860B', 
              'adventure-red': '#8B0000',
              'adventure-sea': '#87A8B3',
            },
            fontFamily: {
              'rounded': ['"Zen Maru Gothic"', 'sans-serif'],
              'serif': ['"Times New Roman"', 'serif'],
            },
            boxShadow: {
              'paper': '2px 3px 5px rgba(62, 39, 35, 0.3)', 
              'deep': 'inset 0 2px 10px rgba(0,0,0,0.2)',
              'deck': '2px 2px 0 #3E2723, 4px 4px 0 #3E2723, 6px 6px 10px rgba(0,0,0,0.3)',
            }
          }
        }
      }
    </script>
    
    <!-- è¨­å®šå­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&display=swap" rel="stylesheet">
    
    <!-- å¼•å…¥ React å’Œ Babel -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            -webkit-tap-highlight-color: transparent;
            background-color: #E6D5B8;
            color: #3E2723;
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #E0C097; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #8B4513; border-radius: 4px; }
        
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }

        @keyframes hop {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }
        .animate-hop { animation: hop 0.6s ease-in-out infinite; }
        
        .vintage-border {
            border: 2px solid #8B4513;
            outline: 2px dashed #BCAAA4;
            outline-offset: -6px;
        }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* --- 3D Dice Styles --- */
        .dice-scene { width: 60px; height: 60px; perspective: 400px; }
        .dice {
            width: 100%; height: 100%; position: relative; transform-style: preserve-3d;
            transition: transform 1s ease-out;
        }
        .dice.rolling { animation: roll 0.5s infinite linear; }
        .dice-face {
            position: absolute; width: 60px; height: 60px;
            background: #FFF; border: 2px solid #E0E0E0; border-radius: 12px;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
            display: flex; align-items: center; justify-content: center;
        }
        .dot { width: 10px; height: 10px; background: #333; border-radius: 50%; box-shadow: inset 1px 1px 2px rgba(0,0,0,0.5); }
        /* Faces positioning */
        .face-1 { transform: rotateY(0deg) translateZ(30px); }
        .face-2 { transform: rotateY(90deg) translateZ(30px); }
        .face-3 { transform: rotateY(180deg) translateZ(30px); }
        .face-4 { transform: rotateY(-90deg) translateZ(30px); }
        .face-5 { transform: rotateX(90deg) translateZ(30px); }
        .face-6 { transform: rotateX(-90deg) translateZ(30px); }
        
        /* Layout for dots */
        .dots-1 { justify-content: center; }
        .dots-2 { justify-content: space-between; padding: 10px; }
        .dots-2 .dot:nth-child(2) { align-self: flex-end; }
        .dots-3 { justify-content: space-between; padding: 10px; }
        .dots-3 .dot:nth-child(2) { align-self: center; }
        .dots-3 .dot:nth-child(3) { align-self: flex-end; }
        .dots-4, .dots-5, .dots-6 { display: grid; grid-template-columns: 1fr 1fr; padding: 10px; gap: 8px; }
        .dots-5 .dot:nth-child(5) { grid-column: 1 / span 2; justify-self: center; align-self: center; }

        @keyframes roll {
            0% { transform: rotateX(0) rotateY(0); }
            100% { transform: rotateX(360deg) rotateY(360deg); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { BookOpen, Heart, Star, MessageCircle, RefreshCw, Check, X, Dices, AlertCircle, PauseCircle, Home, MapPin, Sword, Cross, Scroll, Tent, Footprints, Loader, HelpCircle, AlertTriangle, Play, Info, Send, Hammer, Castle, Flag, WifiOff, Sun, CloudRain, Flame, ExternalLink, Pointer, Facebook, Instagram, AtSign, Mail } from 'lucide-react';

        // --- è³‡æ–™åº« ---
        const BLESSING_VERSES = [
          { text: "ä½ ç•¶å‰›å¼·å£¯è†½ï¼ä¸è¦æ‡¼æ€•ï¼Œä¹Ÿä¸è¦é©šæƒ¶ã€‚", ref: "ç´„æ›¸äºè¨˜ 1:9" },
          { text: "æµæ·šæ’’ç¨®çš„ï¼Œå¿…æ­¡å‘¼æ”¶å‰²ã€‚", ref: "è©©ç¯‡ 126:5" },
          { text: "æˆ‘çš„æ©å…¸å¤ ä½ ç”¨çš„ï¼Œå› ç‚ºæˆ‘çš„èƒ½åŠ›æ˜¯åœ¨äººçš„è»Ÿå¼±ä¸Šé¡¯å¾—å®Œå…¨ã€‚", ref: "å“¥æ—å¤šå¾Œæ›¸ 12:9" },
          { text: "å£“å‚·çš„è˜†è‘¦ï¼Œä»–ä¸æŠ˜æ–·ï¼›å°‡æ®˜çš„ç‡ˆç«ï¼Œä»–ä¸å¹æ»…ã€‚", ref: "ä»¥è³½äºæ›¸ 42:3" },
        ];

        const BIBLE_BOOKS_MAPPING = {
          "å‰µä¸–è¨˜": "Genesis", "å‡ºåŸƒåŠè¨˜": "Exodus", "ç´„æ›¸äºè¨˜": "Joshua", "è©©ç¯‡": "Psalms", "ç®´è¨€": "Proverbs",
          "é¦¬å¤ªç¦éŸ³": "Matthew", "ç´„ç¿°ç¦éŸ³": "John", "ç¾…é¦¬æ›¸": "Romans", "å•Ÿç¤ºéŒ„": "Revelation"
        };
        const BIBLE_BOOKS = Object.keys(BIBLE_BOOKS_MAPPING);

        const FALLBACK_SCRIPTURE = [
            { verse: 1, text: "è€¶å’Œè¯æ˜¯æˆ‘çš„ç‰§è€…ï¼Œæˆ‘å¿…ä¸è‡´ç¼ºä¹ã€‚" },
            { verse: 2, text: "ä»–ä½¿æˆ‘èººè‡¥åœ¨é’è‰åœ°ä¸Šï¼Œé ˜æˆ‘åœ¨å¯å®‰æ­‡çš„æ°´é‚Šã€‚" },
            { verse: 3, text: "ä»–ä½¿æˆ‘çš„éˆé­‚ç”¦é†’ï¼Œç‚ºè‡ªå·±çš„åå¼•å°æˆ‘èµ°ç¾©è·¯ã€‚" },
            { verse: 4, text: "æˆ‘é›–ç„¶è¡Œéæ­»è”­çš„å¹½è°·ï¼Œä¹Ÿä¸æ€•é­å®³ï¼Œå› ç‚ºä½ èˆ‡æˆ‘åŒåœ¨ï¼›ä½ çš„æ–ï¼Œä½ çš„ç«¿ï¼Œéƒ½å®‰æ…°æˆ‘ã€‚" },
            { verse: 5, text: "åœ¨æˆ‘æ•µäººé¢å‰ï¼Œä½ ç‚ºæˆ‘æ“ºè¨­ç­µå¸­ï¼›ä½ ç”¨æ²¹è†äº†æˆ‘çš„é ­ï¼Œä½¿æˆ‘çš„ç¦æ¯æ»¿æº¢ã€‚" },
            { verse: 6, text: "æˆ‘ä¸€ç”Ÿä¸€ä¸–å¿…æœ‰æ©æƒ æ…ˆæ„›éš¨è‘—æˆ‘ï¼›æˆ‘ä¸”è¦ä½åœ¨è€¶å’Œè¯çš„æ®¿ä¸­ï¼Œç›´åˆ°æ°¸é ã€‚" }
        ];

        const FATE_CARDS = [
          { type: 'bad', text: "ç™¾å§“åœ¨æ› é‡ç™¼æ€¨è¨€ï¼Œä¿¡å¿ƒå‹•æ–ã€‚", amount: -30, freeze: false, title: "æ€¨è¨€çš„ç¶²ç¾…" },
          { type: 'bad', text: "è£½é€ äº†é‡‘ç‰›çŠ¢ï¼Œå¾—ç½ªäº†ç¥ã€‚", amount: -50, freeze: true, title: "å¶åƒçš„è©¦æ¢" },
          { type: 'bad', text: "è½ä¿¡æ¢å­çš„æƒ¡ä¿¡ï¼Œä¸æ•¢é€²å»ã€‚", amount: -20, freeze: true, title: "è†½æ€¯çš„å¿ƒ" },
          { type: 'bad', text: "å› ç‚ºè²ªæ„›ä¸–ç•Œï¼Œåº•é¦¬é›¢æ£„äº†é“ç†ã€‚", amount: -40, freeze: false, title: "ä¸–ç•Œçš„èª˜æƒ‘" },
          { type: 'good', text: "ä½ åœ¨æ› é‡ä¸­å–®å–®ä»°æœ›ç¥ã€‚", amount: 50, freeze: false, title: "å …å®šçš„ä¿¡å¿ƒ" },
          { type: 'good', text: "å¤©é™å—å“ªï¼Œæ¯æ—¥ä¾›æ‡‰ã€‚", amount: 30, freeze: false, title: "ç¥çš„ä¾›æ‡‰" },
          { type: 'good', text: "æ“Šæ•—äº†ä¾†è¥²çš„äºç‘ªåŠ›äººã€‚", amount: 40, freeze: false, title: "é ä¸»å¾—å‹" },
          { type: 'good', text: "é›²æŸ±ç«æŸ±æ—¥å¤œå¼•é ˜ã€‚", amount: 60, freeze: false, title: "ç¥çš„åŒåœ¨" },
        ];

        const CHANCE_CARDS = [
          { type: 'quiz', q: "ä»¥è‰²åˆ—äººç¹è¡Œè€¶åˆ©å“¥åŸå¹¾å¤©å¾ŒåŸç‰†å€’å¡Œï¼Ÿ", options: ["3å¤©", "7å¤©", "12å¤©"], ans: 1, reward: 50 },
          { type: 'quiz', q: "èª°åœ¨ç´„æ—¦æ²³ç‚ºè€¶ç©Œæ–½æ´—ï¼Ÿ", options: ["å½¼å¾—", "æ–½æ´—ç´„ç¿°", "ä¿ç¾…"], ans: 1, reward: 50 },
          { type: 'quiz', q: "ä¿ç¾…åœ¨å“ªè£¡çœ‹è¦‹å¤§å…‰è€Œæ‚”æ”¹ï¼Ÿ", options: ["è€¶è·¯æ’’å†·", "å¤§é¦¬è‰²è·¯ä¸Š", "ç¾…é¦¬"], ans: 1, reward: 60 },
          { type: 'quiz', q: "è€¶ç©Œçš„ç¬¬ä¸€å€‹ç¥è¹Ÿæ˜¯ä»€éº¼ï¼Ÿ", options: ["æ°´è®Šé…’", "äº”é¤…äºŒé­š", "é†«æ²»çå­"], ans: 0, reward: 40 },
          { type: 'event_bad', title: "é‡åˆ°å·¨äºº", text: "çœ‹è¦‹äºç´æ—äººé«˜å¤§ï¼Œå¿ƒè£¡å®³æ€•ã€‚", amount: -30 },
          { type: 'event_bad', title: "ç‘ªæ‹‰è‹¦æ°´", text: "æ°´æ˜¯è‹¦çš„ï¼Œç„¡æ³•é£²ç”¨ã€‚", amount: -20 },
          { type: 'event_bad', title: "é‡åˆ°å¼·ç›œ", text: "è·¯é€”ä¸­é­é‡å±éšªï¼Œæå¤±è²¡ç‰©ã€‚", amount: -40 },
        ];

        // --- æ£‹ç›¤è¨­å®š ---
        const INITIAL_BOARD_MAP = [
          { id: 0, type: 'start', label: 'éç´„æ—¦æ²³', name: 'é€²è¿¦å—', color: 'from-yellow-100 to-yellow-200', icon: <Footprints size={20} /> },
          { id: 1, type: 'city', label: 'åŸæ± ', name: 'å‰ç”²', price: 100, rent: 20, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 2, type: 'fate', label: 'å‘½é‹', name: 'æ› é‡', color: 'from-purple-100 to-purple-200', icon: <AlertTriangle size={18} /> },
          { id: 3, type: 'city', label: 'åŸæ± ', name: 'è€¶åˆ©å“¥', price: 120, rent: 25, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 4, type: 'bible', label: 'è®€ç¶“', name: 'æœƒå¹•', color: 'from-blue-50 to-blue-100', icon: <Scroll size={18} /> },
          { id: 5, type: 'city', label: 'åŸæ± ', name: 'è‰¾åŸ', price: 140, rent: 30, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 6, type: 'event_jesus', label: 'æ©å…¸', name: 'åŠ åˆ©åˆ©æµ·', color: 'from-cyan-50 to-cyan-100', icon: <Cross size={18} /> },
          { id: 7, type: 'city', label: 'åŸæ± ', name: 'åŸºé', price: 160, rent: 35, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 8, type: 'chance', label: 'æ©Ÿæœƒ', name: 'æ™ºæ…§é–€', color: 'from-yellow-50 to-yellow-100', icon: <HelpCircle size={18} /> },
          { id: 9, type: 'city', label: 'åŸæ± ', name: 'äºé›…å´™', price: 150, rent: 30, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 10, type: 'prayer', label: 'ç¦±å‘Š', name: 'å®¢è¥¿é¦¬å°¼', color: 'from-orange-50 to-orange-100', icon: <MessageCircle size={18} /> },
          { id: 11, type: 'city', label: 'é‡é®', name: 'å¸Œä¼¯å´™', price: 300, rent: 60, owner: null, level: 0, color: 'from-rose-50 to-rose-100', icon: <Home size={18} /> },
          { id: 12, type: 'event_paul', label: 'äº‹ä»¶', name: 'å¤§é¦¬è‰²è·¯', color: 'from-indigo-50 to-indigo-100', icon: <MapPin size={18} /> },
          { id: 13, type: 'city', label: 'åŸæ± ', name: 'åº•ç’§', price: 200, rent: 40, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 14, type: 'bible', label: 'è®€ç¶“', name: 'åº‡å“©äº', color: 'from-blue-50 to-blue-100', icon: <Scroll size={18} /> },
          { id: 15, type: 'city', label: 'åŸæ± ', name: 'å¤ç‘£', price: 180, rent: 35, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 16, type: 'fate', label: 'å‘½é‹', name: 'é¢¨æµª', color: 'from-purple-100 to-purple-200', icon: <AlertTriangle size={18} /> },
          { id: 17, type: 'city', label: 'åŸæ± ', name: 'ç¤ºåŠ', price: 220, rent: 45, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
          { id: 18, type: 'chance', label: 'æ©Ÿæœƒ', name: 'ä¿¡å¿ƒé–€', color: 'from-yellow-50 to-yellow-100', icon: <HelpCircle size={18} /> },
          { id: 19, type: 'city', label: 'åŸæ± ', name: 'ç¤ºç¾…', price: 250, rent: 50, owner: null, level: 0, color: 'from-amber-50 to-amber-100', icon: <Tent size={18} /> },
        ];

        const getGridPosition = (index) => {
          if (index <= 3) return { x: index, y: 0 };
          if (index <= 9) return { x: 3, y: index - 3 };
          if (index <= 13) return { x: 3 - (index - 10), y: 7 };
          if (index <= 19) return { x: 0, y: 7 - (index - 13) };
          return { x: 0, y: 0 };
        };

        // --- Common Components ---
        const Dice3D = ({ value, rolling }) => {
            const getTransform = (val) => {
                const map = ['rotateX(0deg) rotateY(0deg)', 'rotateX(0deg) rotateY(0deg)', 'rotateY(-90deg)', 'rotateY(180deg)', 'rotateY(90deg)', 'rotateX(-90deg)', 'rotateX(90deg)'];
                return map[val] || map[1];
            };
            return (
                <div className="dice-scene"><div className={`dice ${rolling ? 'rolling' : ''}`} style={{ transform: rolling ? '' : getTransform(value) }}><div className="dice-face face-1 dots-1"><div className="dot" style={{width:16, height:16, background:'#D32F2F'}}></div></div><div className="dice-face face-2 dots-2"><div className="dot"></div><div className="dot"></div></div><div className="dice-face face-3 dots-3"><div className="dot"></div><div className="dot"></div><div className="dot"></div></div><div className="dice-face face-4 dots-4"><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div></div><div className="dice-face face-5 dots-5"><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div></div><div className="dice-face face-6 dots-6"><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div><div className="dot"></div></div></div></div>
            );
        };

        const Deck = ({ type, active, onClick }) => {
            const isFate = type === 'fate';
            const colorClass = isFate ? "bg-[#8E44AD] border-[#6C3483]" : "bg-[#F39C12] border-[#D35400]";
            const icon = isFate ? <AlertTriangle size={20} className="text-white"/> : <HelpCircle size={20} className="text-white"/>;
            const label = isFate ? "å‘½é‹" : "æ©Ÿæœƒ";
            return (
                <div onClick={active ? onClick : undefined} className={`w-20 h-28 rounded-lg border-2 flex flex-col items-center justify-center cursor-pointer transition-all duration-300 relative ${colorClass} ${active ? 'animate-bounce ring-4 ring-yellow-400 z-20' : 'opacity-80 shadow-deck'}`}>
                    <div className="absolute inset-1 border border-white/30 border-dashed rounded pointer-events-none"></div><div className="mb-1">{icon}</div><div className="text-white font-black text-sm tracking-widest writing-vertical-rl">{label}</div><div className={`absolute -bottom-1 -right-1 w-full h-full rounded-lg -z-10 ${isFate ? "bg-[#4A235A]" : "bg-[#A04000]"}`}></div>
                    {active && <div className="absolute -top-10 left-1/2 -translate-x-1/2 bg-black/70 text-white text-[10px] px-2 py-1 rounded animate-pulse whitespace-nowrap">è«‹é»æ“ŠæŠ½å¡</div>}
                </div>
            );
        };

        const BackgroundMap = () => (
             <div className="fixed inset-0 w-full h-full z-[-1] overflow-hidden pointer-events-none"><svg width="100%" height="100%" viewBox="0 0 400 800" preserveAspectRatio="xMidYMid slice" xmlns="http://www.w3.org/2000/svg"><defs><filter id="paper-texture"><feTurbulence type="fractalNoise" baseFrequency="0.04" numOctaves="5"/><feDiffuseLighting lightingColor="#E6D5B8" surfaceScale="2"><feDistantLight azimuth="45" elevation="60"/></feDiffuseLighting></filter><radialGradient id="vignette" cx="50%" cy="50%" r="70%"><stop offset="50%" stopColor="#8B4513" stopOpacity="0"/><stop offset="100%" stopColor="#3E2723" stopOpacity="0.5"/></radialGradient></defs><rect width="100%" height="100%" fill="#E6D5B8"/><rect width="100%" height="100%" filter="url(#paper-texture)" opacity="0.6"/><path d="M -50 0 L 80 0 Q 60 200 40 400 T -20 800 L -50 800 Z" fill="#87A8B3" opacity="0.4" stroke="#546E7A"/><path d="M 280 150 Q 300 130 320 150 T 280 150" fill="#87A8B3" opacity="0.6"/><path d="M 300 160 Q 290 200 310 250 T 290 350" fill="none" stroke="#546E7A" strokeWidth="2" opacity="0.5"/><path d="M 290 350 Q 270 380 290 420 T 310 380 Q 320 360 290 350" fill="#87A8B3" opacity="0.6"/><path d="M 100 700 L 130 650 L 160 700 L 190 660 L 220 700" fill="none" stroke="#5D4037" strokeWidth="2" strokeLinejoin="round" opacity="0.4"/><path d="M 50 750 C 80 700, 150 720, 200 650 S 100 500, 150 450 S 250 350, 280 200" fill="none" stroke="#8B0000" strokeWidth="2" strokeDasharray="6,4" opacity="0.6"/><rect width="100%" height="100%" fill="url(#vignette)" style={{mixBlendMode: 'multiply'}}/></svg></div>
        );

        // --- Start Screen ---
        const StartScreen = ({ onStart }) => (
            <div className="min-h-screen flex flex-col items-center justify-center p-6 text-center relative overflow-hidden">
              <BackgroundMap />
              <div className="z-10 max-w-md w-full bg-[#F3E5AB] p-8 rounded-xl shadow-[0_10px_30px_rgba(62,39,35,0.4)] border-4 border-[#8B4513] relative vintage-border">
                <div className="absolute -top-4 left-1/2 -translate-x-1/2 bg-[#8B4513] text-[#F3E5AB] px-4 py-1 text-sm font-bold rounded shadow-md tracking-widest">BIBLE ADVENTURE</div>
                <h1 className="text-4xl font-black text-[#3E2723] mb-2 font-serif">å¤©åœ‹å¤§å¯Œç¿</h1>
                <h2 className="text-lg font-bold text-[#5D4037] mb-8">- æ‡‰è¨±ä¹‹åœ°ç¯‡ -</h2>
                <div className="flex justify-center items-center gap-8 mb-8"><div className="text-6xl">ğŸ‘</div><div className="text-2xl font-black">VS</div><div className="text-6xl grayscale opacity-80" style={{filter: 'grayscale(100%) brightness(20%)'}}>ğŸ</div></div>
                <div className="text-left mb-8 space-y-3 bg-[#E6D5B8] p-4 rounded border border-[#8B4513]/30 shadow-inner">
                    <h3 className="font-bold text-[#8B4513] mb-3 flex items-center gap-2 border-b border-[#8B4513]/20 pb-2"><Info size={18} /> éŠæˆ²è¦å‰‡</h3>
                    <div className="flex items-start gap-3"><div className="bg-[#8B4513] text-[#F3E5AB] w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0">1</div><p className="text-sm font-bold text-[#3E2723]">æ“²éª°å­ï¼Œç´¯ç© <span className="text-[#8B0000]">ä¿¡å¿ƒå€¼</span>ã€‚</p></div>
                    <div className="flex items-start gap-3"><div className="bg-[#8B4513] text-[#F3E5AB] w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0">2</div><p className="text-sm font-bold text-[#3E2723]">æ”»ä½”åŸæ± ï¼Œå»ºç«‹ <span className="text-[#8B0000]">ç¥­å£‡</span> ç»ç¥­ã€‚</p></div>
                    <div className="flex items-start gap-3"><div className="bg-[#8B4513] text-[#F3E5AB] w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold shrink-0">3</div><p className="text-sm font-bold text-[#3E2723]">é‡åˆ°é»‘å…¬ç¾Šçš„ç‡Ÿå£˜ï¼Œé¸æ“‡ <span className="text-[#8B0000]">æ‹†æ¯€</span> æˆ–ç¥ç¦ã€‚</p></div>
                </div>
                <button onClick={onStart} className="w-full bg-[#8B4513] hover:bg-[#5D4037] text-[#F3E5AB] text-xl font-black py-4 rounded shadow-md border-2 border-[#3E2723]"><Sword size={24} className="inline mr-2"/> é–‹å§‹å¾æˆ°</button>
                <div className="mt-8 pt-6 border-t border-[#8B4513]/30">
                    <p className="text-[#3E2723] font-bold mb-4">è€¶ç©ŒåŠ æ²¹ç«™ x å¾®å…‰æ–°äº‹</p>
                    <div className="flex justify-center gap-4">
                        <a href="https://www.facebook.com/profile.php?id=100068500932557" target="_blank" className="text-[#3E2723] hover:text-[#8B4513] transition-colors"><Facebook size={24} /></a>
                        <a href="https://www.instagram.com/forever.believe.in.jesus/" target="_blank" className="text-[#3E2723] hover:text-[#8B4513] transition-colors"><Instagram size={24} /></a>
                        <a href="https://www.threads.net/@forever.believe.in.jesus" target="_blank" className="text-[#3E2723] hover:text-[#8B4513] transition-colors"><AtSign size={24} /></a>
                        <a href="https://line.me/R/ti/p/@469cjlho" target="_blank" className="text-[#3E2723] hover:text-[#8B4513] transition-colors"><MessageCircle size={24} /></a>
                        <a href="mailto:newthingsinthelittlelight@gmail.com" target="_blank" className="text-[#3E2723] hover:text-[#8B4513] transition-colors"><Mail size={24} /></a>
                    </div>
                </div>
              </div>
            </div>
        );

        const GameButton = ({ onClick, disabled, color = "blue", icon: Icon, children }) => {
            const colors = { blue: "bg-blue-500", amber: "bg-amber-500", indigo: "bg-indigo-500", red: "bg-red-500", purple: "bg-purple-500", gray: "bg-gray-500", orange: "bg-orange-500", cyan: "bg-cyan-500", green: "bg-green-500" };
            return <button onClick={onClick} disabled={disabled} className={`w-full py-3.5 rounded-lg font-bold transition-all flex items-center justify-center gap-2 ${disabled ? "bg-gray-300 cursor-not-allowed" : `${colors[color]} text-white shadow-md active:scale-95`}`}>{Icon && <Icon size={20}/>} {children}</button>;
        };

        const CardFlip = ({ frontTitle, frontColor, backContent, icon }) => {
            const [isFlipped, setIsFlipped] = useState(false);
            return (
                <div className="relative w-full h-[450px] perspective-1000 cursor-pointer group" onClick={() => !isFlipped && setIsFlipped(true)}>
                  <div className={`relative w-full h-full transition-all duration-700 transform-style-3d ${isFlipped ? 'rotate-y-180' : ''}`}>
                    <div className={`absolute w-full h-full bg-gradient-to-br ${frontColor} rounded-xl shadow-[0_10px_20px_rgba(0,0,0,0.3)] flex flex-col items-center justify-center backface-hidden border-8 border-[#3E2723]`}>
                      <div className="border-4 border-dashed border-[#3E2723]/30 w-[90%] h-[90%] absolute rounded-lg pointer-events-none"></div>
                      <div className="bg-[#3E2723] p-6 rounded-full text-[#F3E5AB] mb-6 shadow-md">{icon}</div>
                      <h3 className="text-3xl font-black text-[#3E2723] tracking-[0.2em] uppercase font-serif drop-shadow-sm">{frontTitle}</h3>
                      <div className="absolute bottom-12 text-[#3E2723]/60 text-sm font-bold animate-pulse">é»æ“Šç¿»é–‹è–è«­</div>
                    </div>
                    <div className="absolute w-full h-full bg-[#F3E5AB] rounded-xl shadow-[0_10px_20px_rgba(0,0,0,0.3)] flex flex-col items-center justify-center p-8 backface-hidden rotate-y-180 border-8 border-[#8B4513] overflow-y-auto bg-[url('https://www.transparenttextures.com/patterns/paper.png')]">{backContent}</div>
                  </div>
                </div>
            );
        };

        const FateEvent = ({ onComplete }) => {
            const [card] = useState(() => FATE_CARDS[Math.floor(Math.random() * FATE_CARDS.length)]);
            const isGood = card.type === 'good';
            return <CardFlip frontTitle="å‘½é‹ç‰Œ" frontColor="from-purple-500 to-indigo-600" icon={<AlertTriangle size={64} />} backContent={
              <div className="w-full text-center h-full flex flex-col justify-center">
                <div className={`mb-6 p-4 rounded-full w-20 h-20 mx-auto flex items-center justify-center border-4 ${isGood ? 'bg-[#E8F5E9] border-green-600 text-green-600' : 'bg-[#FFEBEE] border-red-600 text-red-600'}`}>{isGood ? <Sun size={40}/> : <CloudRain size={40}/>}</div>
                <h3 className="text-2xl font-black mb-4 text-[#3E2723]">{card.title}</h3><p className="text-lg font-bold text-[#5D4037] mb-8">{card.text}</p>
                <div className="mb-8"><span className={`text-xl font-black px-4 py-2 rounded ${isGood ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>ä¿¡å¿ƒ {card.amount > 0 ? '+' : ''}{card.amount}</span>{card.freeze && <div className="text-red-600 text-sm mt-2 font-bold flex justify-center items-center gap-1"><PauseCircle size={14}/> æš«åœä¸€å›åˆ</div>}</div>
                <GameButton onClick={() => onComplete(0, card.amount, card.freeze)} color={isGood ? "green" : "red"}>{isGood ? "å“ˆåˆ©è·¯äº" : "æ‚”æ”¹æ±‚ä¸»"}</GameButton>
              </div>
            } />;
        };

        const ChanceEvent = ({ onComplete }) => {
            const [card] = useState(() => CHANCE_CARDS[Math.floor(Math.random() * CHANCE_CARDS.length)]);
            const [quizStatus, setQuizStatus] = useState('ask');
            const handleAns = (idx) => { if (idx === card.ans) { setQuizStatus('correct'); setTimeout(() => onComplete(20, card.reward), 1500); } else { setQuizStatus('wrong'); setTimeout(() => onComplete(0, 0, true), 1500); } };
            const content = card.type === 'quiz' ? (
                <div className="w-full text-center"><h3 className="text-2xl font-black text-[#8B4513] mb-6">è–ç¶“å†·çŸ¥è­˜</h3>
                {quizStatus === 'ask' && (<><p className="text-[#3E2723] font-bold text-lg mb-6">{card.q}</p><div className="space-y-3">{card.options.map((opt, idx) => <button key={idx} onClick={() => handleAns(idx)} className="w-full bg-[#FFF3E0] text-[#5D4037] border-2 border-[#D7CCC8] py-3 rounded-lg font-bold hover:bg-[#FFE0B2]">{opt}</button>)}</div></>)}
                {quizStatus === 'correct' && <div className="py-10 animate-bounce text-green-700"><Check size={40} className="mx-auto"/><p className="text-2xl font-black">ç­”å°äº†ï¼</p><p className="font-bold text-green-600">+{card.reward} ä¿¡å¿ƒ</p></div>}
                {quizStatus === 'wrong' && <div className="py-10 animate-shake text-red-700"><X size={40} className="mx-auto"/><p className="text-2xl font-black">ç­”éŒ¯äº†...</p><p className="font-bold text-red-500">æš«åœä¸€å›</p></div>}
                </div>
            ) : (<div className="w-full text-center h-full flex flex-col justify-center"><CloudRain size={40} className="mx-auto text-gray-500 mb-4"/><h3 className="text-2xl font-black text-[#3E2723] mb-4">{card.title}</h3><p className="text-lg font-bold text-[#5D4037] mb-6">{card.text}</p><div className="inline-block bg-red-50 border border-red-200 px-4 py-2 rounded-lg mb-8"><p className="text-red-800 font-black">ä¿¡å¿ƒå€¼ {card.amount}</p></div><GameButton onClick={() => onComplete(0, card.amount)} color="gray">æ¥å—æŒ‘æˆ°</GameButton></div>);
            return <CardFlip frontTitle="æ©Ÿæœƒç‰Œ" frontColor="bg-[#FFE082]" icon={<HelpCircle size={64} />} backContent={content} />;
        };

        const EventModal = ({ type, tileData, onClose, onComplete, coins, isOwner, onBuy, onUpgrade, onDestroy }) => {
            const CloseButton = () => <button onClick={onClose} className="absolute top-4 right-4 bg-white/50 hover:bg-white text-gray-600 p-2 rounded-full shadow-sm transition-all z-50 border border-white/60"><X size={20} /></button>;
            const BibleReader = () => {
                const [bookName] = useState(BIBLE_BOOKS[Math.floor(Math.random() * BIBLE_BOOKS.length)]);
                const [chapter] = useState(Math.floor(Math.random() * 5) + 1);
                const [content, setContent] = useState(null);
                const [loading, setLoading] = useState(true);
                const [usingFallback, setUsingFallback] = useState(false);
                useEffect(() => { const f=async()=>{setLoading(true);try{const r=await fetch(`https://bible-api.com/${BIBLE_BOOKS_MAPPING[bookName]}+${chapter}?translation=cuv`);if(!r.ok)throw new Error();const d=await r.json();setContent(d.verses);}catch{setUsingFallback(true);setContent(FALLBACK_SCRIPTURE);}setLoading(false);};f();},[]);
                return (<div className="bg-[#FFF8E7] rounded-3xl shadow-2xl border-8 border-[#8B4513] flex flex-col h-[500px] overflow-hidden relative"><CloseButton/><div className="bg-[#F3E5AB] p-4 border-b-2 border-[#D7CCC8] mt-4"><h3 className="text-xl font-black text-[#5D4037] text-center flex justify-center gap-2"><BookOpen/> æ¯æ—¥éˆç³§</h3><p className="text-center text-[#8B4513] font-bold text-sm">{usingFallback?"è©©ç¯‡ 23":`${bookName} ${chapter}`}</p></div><div className="flex-1 overflow-y-auto p-6 custom-scrollbar">{loading?<div className="text-center mt-10"><Loader className="animate-spin inline"/></div>:<div className="space-y-4">{content.map((v,i)=><div key={i} className="flex gap-2 text-sm"><span className="font-bold text-[#8B4513]">{v.verse}</span><span>{v.text}</span></div>)}</div>}</div><div className="p-4 bg-[#F3E5AB] space-y-2"><a href={`https://www.biblegateway.com/passage/?search=${BIBLE_BOOKS_MAPPING[bookName]}+${chapter}&version=CUV`} target="_blank" className="block w-full py-2 bg-white border-2 border-[#8B4513] text-[#8B4513] text-center font-bold rounded-lg hover:bg-[#EFEBE9] flex items-center justify-center gap-2"><ExternalLink size={16}/> å‰å¾€ç¶²ç«™é–±è®€</a><GameButton onClick={()=>onComplete(30,80)} disabled={loading} color="amber" icon={Check}>{loading?"è®€å–ä¸­...":"æˆ‘è®€å®Œäº† (+80 ä¿¡å¿ƒ)"}</GameButton></div></div>);
            };
            const PropertyAction = () => {
                if (tileData.type !== 'city') return null;
                if (isOwner) { const cost=Math.floor(tileData.price*0.6); const isFirst=tileData.level===0; return (<div className="mt-4 border-t-2 border-[#D7CCC8] pt-4"><p className="text-sm font-bold text-center mb-2">å±¬åœ° Lv.{tileData.level}</p><GameButton onClick={()=>onUpgrade(cost)} disabled={coins<cost} color="amber" icon={isFirst?Home:Flame}>{isFirst?`å»ºç«‹ç¥­å£‡ (-${cost})`:`ç»ç¥­ (-${cost})`}</GameButton><p className="text-[10px] text-amber-600 text-center mt-2 font-bold">{isFirst ? "å»ºç«‹ç¥­å£‡å¯ä¿è­·ç”¢æ¥­ä¸è¢«æ‹†æ¯€ï¼" : "ç»ç¥­æ¬¡æ•¸è¶Šå¤šï¼Œéè·¯è²»è¶Šé«˜ï¼"}</p></div>); }
                if (!tileData.owner) return (<div className="mt-4 border-t-2 border-[#D7CCC8] pt-4"><p className="text-sm text-center text-[#5D4037] mb-3 font-bold">æ­¤åœ°ç„¡äººçœ‹å®ˆï¼Œæ˜¯å¦å¾—åœ°ç‚ºæ¥­ï¼Ÿ</p><GameButton onClick={()=>onBuy(tileData.price)} disabled={coins<tileData.price} color="indigo" icon={Sword}>æ”»ä½” (-{tileData.price})</GameButton></div>);
                if (tileData.owner==='cpu') { const rent=tileData.rent*(tileData.level+1); const destroy=tileData.price; const claim=destroy+tileData.price; return (<div className="mt-4 bg-[#FFEBEE] p-3 rounded border border-red-200"><p className="text-center text-red-600 font-bold mb-2">é»‘å…¬ç¾Šç‡Ÿå£˜</p><button onClick={()=>onComplete(0,-rent)} className="w-full py-2 bg-white border border-red-300 rounded text-red-600 font-bold mb-2">ç¥ç¦ (-{rent})</button>{tileData.level===0?<><GameButton onClick={()=>onDestroy(destroy,false)} disabled={coins<destroy} color="red" icon={Hammer}>æ‹†æ¯€ (-{destroy})</GameButton><div className="mt-1"><GameButton onClick={()=>onDestroy(claim,true)} disabled={coins<claim} color="indigo" icon={Sword}>æ‹†æ¯€ä¸¦å»ºç«‹ (-{claim})</GameButton></div></>:<p className="text-center text-xs text-red-400">å°æ–¹å·²å»ºç¥­å£‡ï¼Œç„¡æ³•æ‹†æ¯€</p>}</div>); }
            };
            if (type==='event_jesus') return (<div className="bg-[#FFF8E7] p-8 rounded-3xl border-4 border-[#87CEEB] text-center relative"><CloseButton/><h3 className="text-2xl font-black text-[#0097A7]">âœï¸ é‡è¦‹è€¶ç©Œ</h3><p className="my-4">é ˜å—å±¬å¤©çš„ç¥ç¦...</p><GameButton onClick={()=>onComplete(20,100)} color="cyan">é ˜å— (+100)</GameButton></div>);
            if (type==='event_paul') return (<div className="bg-[#FFF8E7] p-8 rounded-3xl border-4 border-[#5C6BC0] text-center relative"><CloseButton/><h3 className="text-2xl font-black text-[#3949AB]">âš¡ å¤§é¦¬è‰²è·¯</h3><p className="my-4">æš«æ™‚çœ‹ä¸è¦‹ï¼Œä½†ç”Ÿå‘½ç¿»è½‰ã€‚</p><GameButton onClick={()=>onComplete(50,50,true)} color="indigo">é †æœå‘¼å¬ (+50, æš«åœ)</GameButton></div>);
            if (type==='bible') return <div className="relative"><CloseButton/><BibleReader /></div>;
            if (type==='fate') return <div className="relative"><CloseButton/><FateEvent onComplete={onComplete} /></div>;
            if (type==='chance') return <div className="relative"><CloseButton/><ChanceEvent onComplete={onComplete} /></div>;
            if (type==='prayer') { const [val,setVal]=useState(""); return (<div className="bg-[#FFF8E7] p-8 rounded-3xl border-4 border-[#FFB74D] text-center relative"><CloseButton/><h3 className="text-2xl font-black text-[#E65100]">ğŸ™ ç¦±å‘Š</h3><textarea className="w-full p-2 border-2 border-[#FFE0B2] rounded my-4 bg-white" rows="3" onChange={e=>setVal(e.target.value)}/><GameButton onClick={()=>onComplete(20,50)} color="orange" disabled={!val.trim()} icon={Send}>ç™¼å‡º</GameButton><div className="mt-4">{tileData.type==='city'&&<PropertyAction/>}</div></div>); }
            if (type==='city') { const isEnemy=tileData.owner==='cpu'; return (<div className="bg-[#FFF8E7] p-8 rounded-3xl border-4 border-[#D7CCC8] text-center relative"><CloseButton/><h3 className="text-2xl font-black text-[#5D4037]">ğŸ° {tileData.name}</h3><PropertyAction />{!isEnemy&&<button onClick={onClose} className="mt-4 text-sm text-gray-500 underline">æš«ä¸è¡Œå‹•</button>}</div>); }
            return null;
        };

        const App = () => {
          const [gameState, setGameState] = useState('start');
          const [board, setBoard] = useState(INITIAL_BOARD_MAP);
          const [playerPos, setPlayerPos] = useState(0);
          const [cpuPos, setCpuPos] = useState(0);
          const [faith, setFaith] = useState(1000); 
          const [cpuFaith, setCpuFaith] = useState(1000);
          const [level, setLevel] = useState(1);
          const [turn, setTurn] = useState('player'); 
          const [isMoving, setIsMoving] = useState(false);
          const [diceValue, setDiceValue] = useState(1);
          const [activeModal, setActiveModal] = useState(null);
          const [isFrozen, setIsFrozen] = useState(false);
          const [notification, setNotification] = useState(null);
          const [waitingForDraw, setWaitingForDraw] = useState(null);

          const playerProperties = board.filter(t => t.owner === 'player').length;
          const cpuProperties = board.filter(t => t.owner === 'cpu').length;

          const startGame = () => { setGameState('playing'); setFaith(1000); setCpuFaith(1000); setPlayerPos(0); setCpuPos(0); setBoard(INITIAL_BOARD_MAP); setLevel(1); };
          const notify = (text, color="bg-amber-500") => { setNotification({ text, color }); setTimeout(() => setNotification(null), 3000); };
          const handleLandEvent = (pos, who) => {
            const tile = board[pos];
            if (who === 'player' && (tile.type === 'fate' || tile.type === 'chance')) { setWaitingForDraw(tile.type); return; }
            if (tile.type !== 'start') { setTimeout(() => setActiveModal(tile.type), 500); } else { setTurn('cpu'); }
          };
          const rollDice = () => {
            if (isMoving || activeModal || turn !== 'player' || waitingForDraw) return;
            if (isFrozen) { notify("ä»åœ¨æ› é‡çœæ€ä¸­... æš«åœä¸€å›", "bg-gray-500"); setIsMoving(true); setTimeout(() => { setIsFrozen(false); setIsMoving(false); setTurn('cpu'); }, 1500); return; }
            const val = Math.floor(Math.random() * 6) + 1; setDiceValue(val); setIsMoving(true);
            const moveInterval = setInterval(() => { setPlayerPos(prev => (prev + 1) % board.length); }, 200);
          };
          const triggerRoll = () => {
            if (isMoving || activeModal || turn !== 'player' || waitingForDraw) return;
            if (isFrozen) { notify("ä»åœ¨æ› é‡çœæ€ä¸­...", "bg-gray-500"); setIsMoving(true); setTimeout(() => { setIsFrozen(false); setIsMoving(false); setTurn('cpu'); }, 1500); return; }
            const val = Math.floor(Math.random() * 6) + 1; setDiceValue(val); setIsMoving(true);
            let current = playerPos; let count = 0;
            const interval = setInterval(() => {
               current = (current + 1) % board.length; setPlayerPos(current);
               if (current === 0) { setFaith(f => f + 300); notify("ç¶“éç´…æµ·ï¼+300", "bg-yellow-500"); }
               count++;
               if (count === val) { clearInterval(interval); setIsMoving(false); handleLandEvent(current, 'player'); }
            }, 200);
           };
           useEffect(() => {
             if (gameState === 'playing' && turn === 'cpu') {
                setTimeout(() => {
                   const val = Math.floor(Math.random() * 6) + 1; setDiceValue(val); setIsMoving(true);
                   let current = cpuPos; let count = 0;
                   const interval = setInterval(() => {
                      current = (current + 1) % board.length; setCpuPos(current);
                      if (current === 0) setCpuFaith(f => f + 300); count++;
                      if (count === val) { clearInterval(interval); setIsMoving(false); handleCpuLandEvent(current); }
                   }, 200);
                }, 1000);
             }
           }, [turn, gameState]);
           const handleCpuLandEvent = (pos) => {
              const tile = board[pos];
              if (tile.owner === 'player') {
                 if (tile.level === 0 && cpuFaith >= tile.price && Math.random() < 0.4) {
                    const newBoard = [...board]; newBoard[pos].owner = null; newBoard[pos].level = 0; setBoard(newBoard); setCpuFaith(f => f - tile.price); notify(`é»‘å…¬ç¾Šæ”»ç ´äº† ${tile.name}ï¼`, "bg-red-500");
                 } else { const cost = tile.rent * (tile.level + 1); setCpuFaith(f => Math.max(0, f - cost)); setFaith(f => f + cost); notify(`é»‘å…¬ç¾Šä»˜äº† ${cost}`, "bg-green-500"); }
              } else if (tile.type === 'city' && !tile.owner && cpuFaith >= tile.price) {
                 if (Math.random() > 0.5) { const newBoard = [...board]; newBoard[pos].owner = 'cpu'; setBoard(newBoard); setCpuFaith(f => f - tile.price); notify(`é»‘å…¬ç¾Šæ”»ä½” ${tile.name}`, "bg-purple-400"); }
              }
              setTimeout(() => setTurn('player'), 1500);
           };
           const onModalComplete = (xpG, faithC, frz=false) => {
              if(xpG) { const n = xp+xpG; if(n>=level*100) setLevel(l=>l+1); }
              if(faithC) setFaith(f=>Math.max(0, f+faithC));
              if(frz) setIsFrozen(true); setActiveModal(null); setTurn('cpu');
           };
           const handleBuy = (cost) => { const b=[...board]; b[playerPos].owner='player'; setBoard(b); setFaith(f=>f-cost); setActiveModal(null); setTurn('cpu'); };
           const handleUpgrade = (cost) => { const b=[...board]; b[playerPos].level+=1; setBoard(b); setFaith(f=>f-cost); setActiveModal(null); setTurn('cpu'); };
           const handleDestroy = (cost, claim) => { const b=[...board]; b[playerPos].owner=claim?'player':null; b[playerPos].level=0; setBoard(b); setFaith(f=>f-cost); setActiveModal(null); setTurn('cpu'); };

           if (gameState === 'start') return <StartScreen onStart={startGame} />;

           return (
            <div className="min-h-screen flex flex-col items-center justify-center p-2 relative overflow-hidden">
               <BackgroundMap />
               <div className="w-full max-w-md fixed top-4 z-30 px-4">
                  <div className="glass-panel rounded-xl p-3 shadow-floating border border-[#8B4513]/40 bg-[#FFF8E7]/90 backdrop-blur-md">
                     <div className="flex justify-between items-center mb-2 px-2"><div className="flex items-center gap-2"><span className="font-black text-[#5D4037] tracking-widest text-lg font-serif">CANAAN</span><div className="px-3 py-0.5 bg-[#8B4513] text-[#F3E5AB] text-[10px] font-bold rounded shadow-sm border border-[#5D4037]">Lv.{level}</div></div></div>
                     <div className="flex gap-2">
                        <div className={`flex-1 bg-[#F3E5AB] rounded-lg p-2 border transition-all ${turn==='player'?'border-[#8B4513] shadow-md scale-105':'opacity-70'}`}><div className="flex justify-between text-[10px] text-[#8D6E63] font-bold"><span>æˆ‘</span><span><Castle size={10} className="inline"/> {playerProperties}</span></div><div className="flex items-center gap-1 text-[#E65100] font-black text-xl"><Heart size={18} fill="currentColor"/> {faith}</div></div>
                        <div className={`flex-1 bg-[#D7CCC8] rounded-lg p-2 border transition-all ${turn==='cpu'?'border-[#3E2723] shadow-md scale-105':'opacity-70'}`}><div className="flex justify-between text-[10px] text-[#5D4037] font-bold"><span>é»‘å…¬ç¾Š</span><span><Castle size={10} className="inline"/> {cpuProperties}</span></div><div className="text-right text-[#4A148C] font-black text-xl">{cpuFaith} <Heart size={18} fill="currentColor" className="inline"/></div></div>
                     </div>
                  </div>
               </div>
               {notification && <div className={`fixed top-44 z-50 px-6 py-3 rounded-lg text-[#F3E5AB] font-bold shadow-[0_4px_0_#3E2723] animate-bounce text-center backdrop-blur-md border-2 border-[#5D4037] ${notification.color === 'bg-red-500' ? 'bg-[#C62828]' : 'bg-[#EF6C00]'}`}>{notification.text}</div>}
               <div className="relative w-full max-w-md aspect-[9/16] mt-48 mb-4 p-2 scale-95">
                  <div className="w-full h-full bg-[#E6D5B8]/80 rounded-[1.5rem] shadow-[inset_0_0_60px_rgba(62,39,35,0.2)] relative border-8 border-[#8D6E63] outline outline-4 outline-[#5D4037] backdrop-blur-sm overflow-hidden">
                     <div className="absolute top-[12.5%] left-[25%] w-[50%] h-[75%] flex flex-col items-center justify-between py-6 z-20 pointer-events-none">
                        <div className="flex justify-between w-full px-2 pointer-events-auto">
                            <Deck type="fate" active={waitingForDraw === 'fate'} onClick={() => { setActiveModal('fate'); setWaitingForDraw(null); }} />
                            <Deck type="chance" active={waitingForDraw === 'chance'} onClick={() => { setActiveModal('chance'); setWaitingForDraw(null); }} />
                        </div>
                        {!waitingForDraw && (
                            <div className="flex flex-col items-center pointer-events-auto">
                                <div className="w-24 h-24 rounded-full bg-[#FFF8E1] shadow-[inset_0_4px_10px_rgba(0,0,0,0.05)] border-4 border-[#D7CCC8] flex flex-col items-center justify-center mb-4 relative overflow-hidden">
                                    <div className="scale-75"><Dice3D value={diceValue} rolling={isMoving}/></div>
                                </div>
                                <button onClick={triggerRoll} disabled={turn !== 'player' || isMoving || activeModal} className={`w-32 py-3 rounded-xl font-black text-[#F3E5AB] shadow-[0_4px_0_#3E2723] text-sm flex items-center justify-center gap-2 transition-all active:translate-y-1 active:shadow-none border-2 border-[#3E2723] ${turn === 'player' && !isFrozen ? 'bg-[#8B4513] hover:bg-[#6D4C41]' : 'bg-[#BCAAA4] cursor-not-allowed border-[#8D6E63] shadow-none'}`}>{isFrozen ? "è·³é" : "æ“²éª°å­"}</button>
                            </div>
                        )}
                        {waitingForDraw && (<div className="bg-[#FFF8E1] border-2 border-[#8B4513] px-4 py-2 rounded-full text-[#8B4513] font-black animate-bounce shadow-lg flex items-center gap-2 text-sm pointer-events-auto"><Pointer size={16} /> è«‹é»æ“Šç‰Œå †</div>)}
                     </div>
                     {board.map((tile, i) => {
                         const pos = getGridPosition(i);
                         const style = { left: `${pos.x * 25}%`, top: `${pos.y * 12.5}%`, width: '25%', height: '12.5%' };
                         let BuildingIcon = null;
                         if(tile.owner && tile.type === 'city') {
                             const colorClass = tile.owner === 'player' ? 'text-[#1E88E5]' : 'text-[#8E24AA]';
                             BuildingIcon = (<div className={`absolute -top-3 right-0 flex items-end ${colorClass} z-20 drop-shadow-md`}><Castle size={18} fill="currentColor"/>{tile.level>=1 && <div className="flex -ml-1"><Flame size={14} className="text-orange-500" fill="currentColor"/></div>}</div>);
                         }
                         const ownerBorder = tile.owner === 'player' ? 'border-[#1E88E5] border-2 bg-[#E3F2FD]' : tile.owner === 'cpu' ? 'border-[#8E24AA] border-2 bg-[#F3E5F5]' : 'border-[#8D6E63]/30 border bg-[#FFF8E1]';
                         return (
                            <div key={tile.id} className="absolute p-1 transition-all" style={style}>
                                <div className={`w-full h-full rounded shadow-sm flex flex-col items-center justify-center relative overflow-visible ${ownerBorder}`}>
                                    {BuildingIcon}
                                    <div className="text-[#5D4037] transform scale-90 mb-0.5 opacity-80">{tile.icon}</div>
                                    <div className="text-[9px] font-bold text-[#3E2723] leading-none text-center px-0.5 truncate w-full tracking-tight">{tile.name || tile.label}</div>
                                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-30">{playerPos===i && <div className="text-2xl animate-hop -mt-4 drop-shadow-md">ğŸ‘</div>}{cpuPos===i && <div className="text-2xl mt-4 ml-4 drop-shadow-md" style={{filter: 'grayscale(100%) brightness(20%)'}}>ğŸ</div>}</div>
                                </div>
                            </div>
                         )
                     })}
                  </div>
               </div>
               {activeModal && (<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-[#3E2723]/60 backdrop-blur-sm"><div className="w-full max-w-sm animate-hop"><EventModal type={activeModal} tileData={board[playerPos]} coins={faith} isOwner={board[playerPos].owner === 'player'} isFrozen={isFrozen} onClose={() => { setActiveModal(null); setTurn('cpu'); }} onComplete={onModalComplete} onBuy={handleBuy} onUpgrade={handleUpgrade} onDestroy={handleDestroy} /></div></div>)}
            </div>
           );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
